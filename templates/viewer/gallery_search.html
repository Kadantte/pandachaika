{% extends "viewer/base.html" %}
{% block title %}Galleries | {{ block.super }}{% endblock %}
{% block sidebar %}{% endblock %}

{% load staticfiles %}

{% block content %}
  {% load static %}
  {% load viewer_extras %}
  {% if messages %}
    {% for message in messages %}
      <div class="alert {% if message.tags %}alert-{{ message.tags }}{% endif %}" role="alert">{{ message }}</div>
    {% endfor %}
  {% endif %}
  <!-- Form  -->
  <form action="{% url 'viewer:gallery-list' %}" method="GET" role="form">
    <div id="main-search" class="collapse{% if prm.main_filters %} in{% endif %}">
      {% for field in form %}
        <div class="page-line">
          {{ field.errors }}
          {{ field }}
        </div>
      {% endfor %}

      <div id="extra_filters" class="page-line form-inline collapse{% if prm.extra_filters %} in{% endif %}">
        <input type="text" class="form-control" name="category" size="15" value="{{ display_prms.category }}" placeholder="Category"/>
        <input type="text" class="form-control" name="provider" size="10" value="{{ display_prms.provider }}" placeholder="Provider"/>
        <input type="text" class="form-control" name="uploader" size="15" value="{{ display_prms.uploader }}" placeholder="Uploader"/>
        <label>Rating</label>
        <input size="3" type="text" class="form-control" name="rating_from" value="{{ display_prms.rating_from }}" placeholder="from"/>
        <input size="3" type="text" class="form-control" name="rating_to" value="{{ display_prms.rating_to }}" placeholder="to"/>
        <label>Filesize</label>
        <input size="3" type="text" class="form-control" name="filesize_from" value="{{ display_prms.filesize_from }}" placeholder="from"/>
        <input size="3" type="text" class="form-control" name="filesize_to" value="{{ display_prms.filesize_to }}" placeholder="to"/>
        <label>Filecount</label>
        <input size="2" type="text" class="form-control" name="filecount_from" value="{{ display_prms.filecount_from }}" placeholder="from"/>
        <input size="2" type="text" class="form-control" name="filecount_to" value="{{ display_prms.filecount_to }}" placeholder="to"/>
        <input id="checkbox1" type="checkbox" name="expunged" value="1" {% if display_prms.expunged == '1' %}checked{% endif %}><label for="checkbox1"><span><span></span></span>Expunged</label>
        {% if user.is_staff %}
          <input id="checkbox2" type="checkbox" name="hidden" value="1" {% if display_prms.hidden == '1' %}checked{% endif %}><label for="checkbox2"><span><span></span></span>Hidden</label>
          <input id="checkbox4" type="checkbox" name="not_used" value="1" {% if display_prms.not_used == '1' %}checked{% endif %}><label for="checkbox4"><span><span></span></span>Not used</label>
        {% endif %}
        <input id="checkbox3" type="checkbox" name="fjord" value="1" {% if display_prms.fjord == '1' %}checked{% endif %}><label for="checkbox3"><span><span></span></span>Fjord</label>
      </div>
      <div class="page-line form-inline">

        <label for="sort">Sort</label>
        <select id="sort" name="sort" class="form-control">
          <option value="title" {% if prm.sort == "title" %}selected{% endif %}>title</option>
          <option value="title_jpn" {% if prm.sort == "title_jpn" %}selected{% endif %}>title_jpn</option>
          <option value="posted" {% if prm.sort == "posted" %}selected{% endif %}>posted date</option>
          <option value="create_date" {% if prm.sort == "create_date" %}selected{% endif %}>create date</option>
          <option value="rating" {% if prm.sort == "rating" %}selected{% endif %}>rating</option>
          <option value="filecount" {% if prm.sort == "filecount" %}selected{% endif %}>filecount</option>
          <option value="filesize" {% if prm.sort == "filesize" %}selected{% endif %}>filesize</option>
        </select>

        <select name="asc_desc" class="form-control" title="sort_order" aria-label="sort_order">
          <option value="asc" {% if prm.asc_desc == "asc" %}selected{% endif %}>ascending</option>
          <option value="desc" {% if prm.asc_desc == "desc" %}selected{% endif %}>descending</option>
        </select>
        <button type="submit" name="apply" class="btn btn-default">Search</button>
        <button type="submit" name="clear" class="btn btn-default">Clear</button>
        {#        <button type="submit" name="random" class="btn btn-default">I'm feeling lucky</button>#}
        <button type="button" class="btn btn-info" data-toggle="collapse" data-target="#extra_filters">More filters</button>
      </div>
    </div>
  </form>
  {% if results %}
    <!-- Next/Prev page links  -->
    <div class="row">
      <div class="col-md-4">
        {% if results.paginator.num_pages > 1 %}
          <nav>
            <ul class="pagination">
              <li {% if results.number == 1 %} class="disabled"{% endif %}>
                <a href="?{% url_replace 'page' '1' %}" aria-label="First">
                  <span aria-hidden="true">&laquo;</span>
                </a>
              </li>
              {% for p in display_prms.page_range %}
                <li {% ifequal p results.number %} class="active" {% endifequal %}><a
                    href="?{% url_replace 'page' p %}">{{ p }}</a></li>
              {% empty %}
                <li class="active"><a href="?{% url_replace 'page' '1' %}">1</a></li>
              {% endfor %}
              <li {% if results.number == results.paginator.num_pages %}
                class="disabled"{% endif %}>
                <a href="?{% url_replace 'page' results.paginator.num_pages %}"
                   aria-label="Last">
                  <span aria-hidden="true">&raquo;</span>
                </a>
              </li>
            </ul>
          </nav>
        {% endif %}
      </div>
      <div class="col-md-4">
        <ul class="pager">
          {% if results.has_previous %}
            <li><a href="?{% url_replace 'page' results.previous_page_number %}">Previous</a></li>
          {% else %}
            <li class="disabled"><a href="#">Previous</a></li>
          {% endif %}
          <li class="text-center">
            <span>{{ results.paginator.count }} galleries, {{ results.paginator.num_pages }} pages</span>
          </li>
          {% if results.has_next %}
            <li><a href="?{% url_replace 'page' results.next_page_number %}">Next</a></li>
          {% else %}
            <li class="disabled"><a href="#">Next</a></li>
          {% endif %}
        </ul>
      </div>

    </div>
    <!-- Results  -->
    <table class="result-table">
      <thead>
      <tr>
        <th><a href="?{% url_replace 'sort' 'posted' %}">Posted</a></th>
        <th><a href="?{% url_replace 'sort' 'title' %}">Title</a></th>
        <th><a href="?{% url_replace 'sort' 'title' %}">Provider</a></th>
        <th><a href="?{% url_replace 'sort' 'category' %}">Category</a></th>
        <th><a href="?{% url_replace 'sort' 'filecount' %}">Images</a></th>
        <th><a href="?{% url_replace 'sort' 'filesize' %}">Size</a></th>
      </tr>
      </thead>
      <tbody>
      {% for gallery in results.object_list %}
        <tr class="result-list">
          <td>{{ gallery.posted|date:"SHORT_DATE_FORMAT" }}</td>
          <td><a href="{% url 'viewer:gallery' gallery.pk %}" {% if gallery.thumbnail.name %} data-image-url="{{ gallery.thumbnail.url }}" class="img-preview" rel="popover"{% else %} title ="{{ gallery.title_jpn }}"{% endif %}>{% if gallery.title %}{{ gallery.title }}{% else %}{{ gallery.title_jpn }}{% endif %}</a></td>
          <td>{{ gallery.provider }}</td>
          <td>{{ gallery.category }}</td>
          <td>{{ gallery.filecount }}</td>
          <td>{{ gallery.filesize|filesizeformat }}</td>
        </tr>
      {% endfor %}
      </tbody>
    </table>
    <!-- Next/Prev page links  -->
    <div class="row">
      <div class="col-md-4">
        {% if results.paginator.num_pages > 1 %}
          <nav>
            <ul class="pagination">
              <li {% if results.number == 1 %} class="disabled"{% endif %}>
                <a href="?{% url_replace 'page' '1' %}" aria-label="First">
                  <span aria-hidden="true">&laquo;</span>
                </a>
              </li>
              {% for p in display_prms.page_range %}
                <li {% ifequal p results.number %} class="active" {% endifequal %}><a
                    href="?{% url_replace 'page' p %}">{{ p }}</a></li>
              {% empty %}
                <li class="active"><a href="?{% url_replace 'page' '1' %}">1</a></li>
              {% endfor %}
              <li {% if results.number == results.paginator.num_pages %}
                class="disabled"{% endif %}>
                <a href="?{% url_replace 'page' results.paginator.num_pages %}"
                   aria-label="Last">
                  <span aria-hidden="true">&raquo;</span>
                </a>
              </li>
            </ul>
          </nav>
        {% endif %}
      </div>

    </div>
  {% else %}
    <div class="row">
      <div class="col-xs-12 text-center">
        <div><h4><strong>No results</strong></h4></div>
      </div>
    </div>
  {% endif %}
{% endblock %}
{% block afterJQ %}
  {% load compress %}
  {% compress css %}
    <link href="{% static 'autocomplete_light/vendor/jal/src/style.css' %}" type="text/css" media="all" rel="stylesheet" />
  {% endcompress %}
  {% compress js %}
    <script type="text/javascript" src="{% static 'autocomplete_light/jquery.init.js' %}"></script>
    <script type="text/javascript" src="{% static 'autocomplete_light/autocomplete.init.js' %}"></script>
    <script type="text/javascript" src="{% static 'autocomplete_light/vendor/jal/src/autocomplete.js' %}"></script>
    <script type="text/javascript" src="{% static 'autocomplete_light/vendor/jal/src/text_widget.js' %}"></script>
    <script type="text/javascript" src="{% static 'autocomplete_light/jal.js' %}"></script>
  {% endcompress %}
{% endblock %}